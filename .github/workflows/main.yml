name: Ubuntu GNOME Desktop with Tailscale
on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Tailscale Kur ve Bağlan
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

      - name: GNOME ve VNC Kurulumu (Operasyon Başlıyor)
        run: |
          export DEBIAN_FRONTEND=noninteractive
          sudo apt-get update
          # Temel masaüstü bileşenleri ve TigerVNC kuruyoruz
          sudo apt-get install -y ubuntu-desktop-minimal tigervnc-standalone-server tigervnc-common
          
          # VNC şifresini ayarla (Ed4kaleen2024!)
          mkdir -p ~/.vnc
          echo "Ed4kaleen2024!" | vncpasswd -f > ~/.vnc/passwd
          chmod 600 ~/.vnc/passwd
          
          # VNC server'ı başlat (Ekran :1, Port 5901)
          # 'localhost no' diyerek dışarıdan (Tailscale üzerinden) erişime açıyoruz
          vncserver :1 -geometry 1280x720 -depth 24 -localhost no

      - name: Bağlantı Bilgileri (Künye)
        run: |
          echo "---------------------------------------------------"
          echo "CİHAZIN TAILSCALE IP: $(tailscale ip -4)"
          echo "VNC PORTU: 5901"
          echo "VNC ŞİFRESİ: Ed4kaleen2024!"
          echo "---------------------------------------------------"
          echo "Bağlanmak için: IP:5901 örneğin 100.64.0.1:5901"

      - name: Nöbet Tut (6 Saat)
        run: sleep 21600
        
